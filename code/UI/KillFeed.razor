@using Sandbox
@using Sandbox.UI
@using System.Collections.Generic

@namespace Pace.UI
@attribute [StyleSheet]
@inherits Panel

<root>
    @foreach (var entry in Entries)
    {
        <div class="entry">
            <div class=@IsMe(entry.left)>@entry.left</div>
            <img src=@entry.weapon />
            <div class=@IsMe(entry.right)>@entry.right</div>
        </div>
    }
</root>

@code
{
    private static KillFeed Instance { get; set; }

    public record Entry(string left, string weapon, string right, RealTimeSince timeSinceAdded);
    List<Entry> Entries = new();

    public KillFeed() => Instance = this;

    public override void Tick()
    {
        if (Entries.RemoveAll(x => x.timeSinceAdded > 20f) > 0)
        {
            StateHasChanged();
        }
    }

    public static void AddEntry(string left, string weapon, string right)
    {
        Instance.Entries.Add(new Entry(left, weapon, right, 0f));
        Instance.StateHasChanged();
    }

    private string IsMe(string name)
    {
        return name == Connection.Local.DisplayName ? "me" : string.Empty;
    }
}